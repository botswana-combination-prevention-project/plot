{% load tz %}
{% load staticfiles %}
{% load crispy_forms_tags %}

<div class="container">
   <div class="row">
      <div class="col-md-12">
        <div class="panel-group">
          <div class="panel panel-info">
            <div class="panel-heading clearfix">
              <div class="container-fluid"><i class="fa fa-building fa-lg"></i>
              <a title="add plot" href="{% url 'plot:plot_admin:plot_plot_add' %}?next=plot:list_url" class="btn btn-sm btn-default" role="button"><i class="fa fa-plus fa-sm"></i> Add ESS Plot</a>
              <div class="btn-group pull-right">
                <button type="button" class="btn btn-default"> Filters <i class="fa fa-filter"></i> </button>
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
                <ul class="dropdown-menu" role="menu">
                  <li class="dropdown-header">Accessible</li>
                  <li><a href="{% url 'plot:list_url' %}&accessible__exact=1"><i class="fa fa-square-o fa-sm"></i> Yes</a></li>
                  <li><a href="{% url 'plot:list_url' %}&accessible__exact=0"><i class="fa fa-square-o fa-sm"></i> No</a></li>
                  <li class="dropdown-header">Confirmed</li>
                  <li><a href="{% url 'plot:list_url' %}&confirmed__exact=1"><i class="fa fa-square-o fa-sm"></i> Yes</a></li>
                  <li><a href="{% url 'plot:list_url' %}&confirmed__exact=0"><i class="fa fa-square-o fa-sm"></i> No</a></li>
                </ul>
              </div>
               {% include 'edc_search/search_form.html' %}
            </div></div>
            <div class="panel-body">
              <!--start results-->
              {% if results %}
                  <div class="table table-responsive">
                    <table class="table table-condensed table-hover small">
                      <thead>
                      		<th>#</th>
                      		<th></th>
                          <th>Status</th>
                          <th>Attempts</th>
                          <th>Type</th>
                          <th>Estimate</th>
                      		<th>Modified</th>                          
                          <th>Host</th>                          
                        </thead>
                        <tbody>
                        {% for result in results %}
                          <tr>
                            <!--counter-->
                            <td>{{ forloop.counter }}</td>
                            <!--buttons-->
                            <td style="white-space: nowrap">
                              <!--plot log entry history -->
                              <div class="btn-group">
                                <div class="btn-group">
                                  <a title="Add plot log" type="button" class="btn {% if result.plot_log_entry %}btn-default disabled{% else %}btn-warning{% endif %} btn-sm dropdown-toggle"
                                    href="{% url 'plot:plot_admin:plot_plotlogentry_add' %}?plot_log={{result.plot_log.pk}}&next=plot:list_url,plot_identifier&plot_identifier={{ result.plot.plot_identifier }}">
                                      <i class="fa fa-plus"></i>
                                  </a>
                                </div>
                                <button title = "Plot logs" type="button" class="btn btn-default btn-sm">
                                  <i class="fa fa-history fa-lg"></i> <i class="fa fa-files-o fa-lg"></i></button>
                                <div class="btn-group">
                                  <button title="History" type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown">
                                      <span class="caret"></span></button>
                                      <ul class="dropdown-menu" role="menu">
                                        <li class="dropdown-header">Plot logs</li>
                                        {% for log_entry in result.plot_log_entries %}
                                          <li><a href="{% url 'plot:plot_admin:plot_plotlogentry_change' log_entry.pk %}?next=plot:list_url,plot_identifier&plot_identifier={{ result.plot.plot_identifier }}&plot_log={{ log_entry.plot_log.id }}">{{ log_entry.report_datetime }}</a></li>
                                        {% endfor %}
                                      </ul>
                                </div>
                              </div>
                              <!--end plot log entry history -->
                              <a title="change plot" role="button" class="btn btn-sm {% if result.plot.confirmed %}btn-success{%else%}btn-default{%endif%}{% if not result.plot_log_entry %} disabled{% endif %}" href="{% url 'plot:plot_admin:plot_plot_change' result.plot.id %}?next=plot:list_url,plot_identifier&plot_identifier={{ result.plot.plot_identifier }}"><i class="fa fa-building-o fa-lg"></i> {{ result.plot.plot_identifier }} <i class="fa fa-pencil fa-sm"></i></a>
                              <a title="households" role="button" class="btn btn-sm btn-default{% if result.plot.household_count == 0 %} disabled{% endif %}" href="{% url 'household:list_url' plot_identifier=result.plot.plot_identifier %}"> <i class="fa fa-home fa-lg"></i></a>
                          		<a title="map" role="button" class="btn btn-sm btn-default" href="{% url 'plot:map_url' map_area=result.plot.map_area plot_identifier=result.plot.plot_identifier %}"><i class="fa fa-map-marker fa-lg"></i></a>
                            </td>
                            <!--status-->
                            <td>
                              {% if result.plot.confirmed %}<span class="label label-info label-sm">confirmed</span>{% else %}<span class="label label-warning label-sm">unconfirmed</span>{% endif %}
                              {% if result.plot.status %}<span class="label label-{% if result.plot.status == RESIDENTIAL_HABITABLE %}info{% else %}default{% endif %} label-sm">{{ result.plot.get_status_display }}</span>{% endif %}
                            </td>
                            <td>{% if result.plot.access_attempts != 0 %}{{result.plot.access_attempts}}{% endif %}</td>
                            <!--type-->
                            <td>
                              {% if result.plot.ess %}<span class="label label-info label-sm">ESS</span>{% endif %}
                              {% if result.plot.rss %}<span class="label label-info label-sm">RSS</span>{% endif %}
                              {% if result.plot.htc and result.excluded_plot %}<span class="label label-error label-sm">HTC</span>{% endif %}
                              {% if result.plot.htc and not result.excluded_plot %}<span class="label label-info label-sm">HTC</span>{% endif %}
                              {% if result.excluded_plot %}<span class="label label-error label-sm">excluded</span>{% endif %}
                            </td>
                            <!--estimate-->
                            <td>{% if result.plot_log_entries %}{{ result.plot.household_count }} <i class="fa fa-home fa-sm"></i> {{ result.plot.eligible_members }} <i class="fa fa-group fa-sm"></i>{% endif %}</td>
                            <!--audit-->
                            <td>{{ result.plot.modified|date:"Y-m-d H:i" }}</td>
                            <td>{{ result.plot.hostname_created }}</td>
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                    <table>
                    <tr><td>&nbsp;</td></tr>
                    <tr><td>&nbsp;</td></tr>
                    <tr><td>&nbsp;</td></tr>
                    <tr><td>&nbsp;</td></tr>
                    <tr><td>&nbsp;</td></tr>
                    </table>
                    {% include 'edc_search/paginator.html' %}
                  </div>
              {% endif %}
              <!--end results-->
            </div>
          </div>
        </div>
      </div>
    </div> 
  </div>
